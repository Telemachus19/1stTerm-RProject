---
title: "Project Report"
output: 
  hrbrthemes::ipsum_pdf:
    toc : true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,  dev = "cairo_pdf")
```
# Team members

-   Ahmed Ashraf Mohamed

    -   ID: 2022446758

-   Abdelrhman Mohamed Abdelhady Hodid

    -   ID : 2022513643

-   Antonuose Gerges Nageh

    -   ID : 20221903971

# Project Description

# Getting and preparing the data set

## importing the library we are going to use

```{r importing the library me, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(forcats)
library(arules)
library(hrbrthemes)
```

## Reading the data and checking the frist 10 rows of it

```{r Getting data, echo=TRUE}
dataPath <- readline("Enter the path to the data set : ")
grc <- as_tibble(read.csv(dataPath,stringsAsFactors = FALSE))
# displaying first 10 rows of our data
print(grc,n = 10, width = 80)
```
## Preparing the data for k-means and apriori algorithms
```{r Preparing the data for k-means and apriori algorithms}
# creating a data framing containing customers, their ages and total spending
grc_customers <- grc %>%
  select(customer,age,total) %>%
  group_by(customer)%>%
  mutate(total = sum(total))%>% 
  unique()
# making the data frame suitable for k-means
grc_k <- data.frame(grc_customers[,2:3],row.names = grc_customers$customer)
# splitting the items to be suitable for apriori algorithms
tdata <- strsplit(as.vector(grc$items), ',')
tdata <- transactions(tdata)
```
# Visualizing our Data

## Comparison between cash and creadit total spending using box plot

```{r Comparison between cash and creadit total spending using box plot, out.width=c('50%', '50%'), fig.show='hold'}
boxplot_cashCredit <- ggplot(
  grc,
  aes(x = paymentType, y = total, fill = paymentType)) +
  stat_boxplot(geom = "errorbar", width = .2) +
  geom_boxplot(width = .2,
               outlier.color = "orange",
               outlier.size = 2)+
  theme_ipsum_rc() +
  xlab("Payment Type") +
  ylab("Total") + 
  theme(
    plot.title = element_text(size=16)) +
  ggtitle("Comparing cash and credit total using box plot")
barplot_cashCredit <- ggplot(grc,
                             aes(x = paymentType,
                                 y = total,
                                 fill = paymentType)) +
  geom_col(width = .3) +
  scale_y_continuous(n.breaks = 12) +
  theme_ipsum() + 
  theme(
    plot.title = element_text(size = 16)) + 
  ggtitle("Comparing cash and credit total using bar plot")

print(boxplot_cashCredit)
print(barplot_cashCredit)
```

### Observations

After brief moments of seeing the figure, it is quite easy to see that people nearly equally pay with Cash or credit money. 


## Compare each age and sum of total spending.

### Before visualizing

let's create a contingency table using the data prepared and look at a table containing customers, their ages and their total individual spending
```{r}
table(grc_customers$age)
arrange(grc_customers,desc(total))
```
It becomes clear that there are more people aged (22,37 and 55) than the other age groups


```{r Compare each age and sum of total spending,  out.width=c('50%', '50%'), fig.show='hold'}
customersBarPlot<- grc_customers %>%
  ggplot(
    aes(x = customer, y = total)
  ) + 
  geom_col() +
  coord_flip()+
  theme_ipsum() +
  theme(
    plot.title = element_text(size=16))+
  ggtitle("comparing the customers spending")
grc_age <- select(grc,age,total)
grc_age <- grc_age %>% 
  group_by(age) %>%
  summarise(totalSpending = sum(total))
grc_age <- mutate(grc_age,age = fct_reorder(as.factor(age),totalSpending))
barPlotAgeSum<-ggplot(
  grc_age,
  aes(x = age, y = totalSpending)) +
  geom_col() +
  coord_flip() +
  theme_ipsum() +
  theme(
    plot.title = element_text(size=16),
    legend.position = "none")+
  ggtitle("Comparing age and the total spending using bar Plot")
customersBarPlot
barPlotAgeSum
```

### Observations

Since there are more customers aged (22, 37 and 55), it makes sense that the total spending of these groups is higher than the rest. But, looking at the data again we can see that if we look at the customers and their individual spending, we find that customers aged between 20 and 30 -even though there are single individual of these groups- are the highest spending.

```{r}
###Cleaning the data in order to be prepared for data visualization
C_Vs_To <-grc %>%
  select(city,total) %>%
  group_by(city) %>%
  summarise(totalspending = sum(total))
C_Vs_To <- mutate(C_Vs_To, city = fct_reorder(as.factor(city),totalspending))
print(C_Vs_To)
###Visualizing

CityandTotalspending<- ggplot(C_Vs_To,aes(city,totalspending)) +
  geom_segment( aes(xend=city,y = 0,yend=totalspending)) +
  scale_y_continuous(n.breaks = 10) +
  geom_point( color="blue", size=9, alpha=.9) +
  theme_light() +
  xlab("City") +
  ylab("Total Spending") + 
  coord_flip() + 
  theme(
    plot.title = element_text(size=16))+
  ggtitle("Cities VS. Total Spending")

print(CityandTotalspending)
```

```{r}
## Display the distribution of total spending.
Distribution_of_total_spending<-ggplot(grc_customers,aes(total)) +
  stat_boxplot(geom = "errorbar",width = .9) + 
  geom_boxplot(fill = "antiquewhite4",) +
  scale_x_continuous(n.breaks = 8) +
  theme_grey() +
  theme(
    plot.title = element_text(size=16),
    axis.text.y = element_blank()) +
  xlab("Total Spending")  +
  ggtitle("Distribution of Total spending")
print(Distribution_of_total_spending)
```

## Dashboard

```{r dashboard, echo=FALSE, fig.show='hold', out.width=c('50%', '50%')}
boxplot_cashCredit
barplot_cashCredit
customersBarPlot
barPlotAgeSum
CityandTotalspending
Distribution_of_total_spending
```

# K-means
```{r}
No_of_clusters<-as.numeric(readline("Enter the number of clusters: "))
Kmeans_Algorithm<-kmeans(grc_kmeans,centers = No_of_clusters)
grc_kmeans<-mutate(grc_kmeans,cluster=Kmeans_Algorithm$cluster)
print(grc_kmeans)
```

# Generating of association rules

## Brief explanition of Apriori algorithm for generating the rules

Apriori algorithm is an iterative approach for discovering the most frequent item sets. The frequent item sets generated by the algorithm can be used to determine association rules that highlight general trends in the data-set, it is especially useful in the analysis of super-market items in our data set

## Implementing the alogrithm

### Reading both minimum support and minimum confidance from the user
```{r geting the minimum support and minimum confidance}
min_support <- as.numeric(readline("Enter the minimum Support : "))
min_conf <- as.numeric(readline("Enter the minimum Confidance : "))
```
### implementing the algorithm using the built-in function
```{r implementation}
apriori_rules <- apriori(
  tdata,
  parameter = list(supp = min_support, conf = min_conf, minlen = 2))
# Displaying at most 100 rows of the rules
as_tibble(DATAFRAME(apriori_rules,separate = TRUE, setStart = "", setEnd = "")) %>%
  print(n = 100, width = 90)
```
